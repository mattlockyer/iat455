<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=640">

  <link rel="stylesheet" href="stylesheets/core.css" media="screen">
  <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">

  <script type="text/javascript" src="javascripts/modernizr.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      $('#main_content').headsmart()
    })
  </script>


  <!-- hightlighter -->
  <script type="text/javascript" src="highlighter/scripts/shCore.js"></script>
  <script type="text/javascript" src="highlighter/scripts/shBrushJScript.js"></script>
  <link type="text/css" rel="stylesheet" href="highlighter/styles/shCore.css"/>
  <link type="text/css" rel="stylesheet" href="highlighter/styles/shThemeDefault.css"/>
  <script type="text/javascript">
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.all();
  </script>


  <title>IAT 455 - Workshop 1 - Working with Pixels - Matt Lockyer</title>
</head>

<body>
  <div class="shell">

    <header>
      <span class="ribbon-outer">
        <span class="ribbon-inner">
          <h1>Iat455</h1>
          <h2>Workshops</h2>
        </span>
        <span class="left-tail"></span>
        <span class="right-tail"></span>
      </span>
    </header>

    <section id="downloads">
      <span class="inner">
        <a href="index.html" class="zip">
          <em></em> Home
        </a>
        <a href="workshops.html" class="tgz">
          <em></em> Workshops
        </a>
      </span>
    </section>


    <span class="banner-fix"></span>


    <section id="main_content">


      <h3>
        Working with Pixels
      </h3>


      <p>
        <strong>Bitmap:</strong> every bitmap image is represented as a... map of bits. 8 bits make a byte, and a byte is capable of storing values from 0-255 inclusive (or -127-128).
      </p>

      <p>
        See this <a href="http://en.wikipedia.org/wiki/Color_depth" target="_blank">link</a> for more about bits and bytes.
      </p>

      <p>
        Take a look at this example of a 4 pixel image:
      </p>

      <img src="http://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Bmp_format.svg/134px-Bmp_format.svg.png" alt="4 pixel image" />
      <br />
      <br />
      <img src="http://falcon80.com/Images/PixelManipulation/getImageData.png" alt="pixel array image" />

      <p>
        In this image each row is 2 pixels long, and the 4th pixel is on the second row, second column, with 4 bytes per pixel. 
        We can use this formula:
      </p>

      <pre class="brush: js;">
        var bpc = 4; //bytes per pixel
        var imgWidth = 2;
        var pixelRow = 1;
        var pixelCol = 1;
        var pixel = pixelRow * bpc * imgWidth
                    + pixelCol * bpc;
      </pre>

      <p>
        The pixels that represent an HTML5 Canvas element are stored in the data property of an ImageData object. The data property stores these pixels as a single dimension, interleaved array of byte values for each color channel: Red, Green, Blue, Alpha (RGBA).
      </p>

      <p>
        So if you wanted the green value of the 4th pixel, you would use the formula above to figure out this would be the value at index 13 in the array: Pixels.data[13]. Take a look at this example:
      </p>

      <pre class="brush: js;">
        //get ImageData object using canvas 2d context
        var imageData = context.getImageData(0, 0, context.canvas.width, context.canvas.height);
        //get the green value of the 4th pixel
        var pixel4greenChannel = imageData.data[13];
      </pre>

      <p>
        You can also change the values in this array directly but you must set the new ImageData object on the canvas 2d context in order to have a visible effect. Here's an example:
      </p>

      <pre class="brush: js;">
      //make the 4th pixel black
      for (var i = 0; i < 3; i++) {
        imageData.data[12 + i] = 0;
      }
      imageData.data[15] = 255; //full opacity
      context.setImageData(imageData, 0, 0);
    </pre>

    <p>
      In your workshops, there is a lib called media.js which includes a straightforward way to work with canvas elements and their contexts like this:
    </p>

    <pre class="brush: js;">
      //make a new Canvas object (not element)
      var canvas = new Canvas();
      //properties
      canvas.context;
      canvas.width;
      canvas.height;
      //methods
      var imageData = canvas.getImageData();
      canvas.setImageData(imageData);
    </pre>

    <p>
    There is another way to access pixels and it involves working with a single value as a 32 bit unsigned integer. This technique is faster than manipulating the data property of the ImageData object. Take a look:
    </p>

    <pre class="brush: js;">
    var img = canvas.getImageData(),
    data32 = new Uint32Array(img.data.buffer);
    //looping all pixels
    for (var i = 0; i < data32.length; i++) {
      var pixel = data32[i];
      //get the colors out of the pixel value
      var r = (pixel) & 0xff,
      g = (pixel >> 8) & 0xff,
      b = (pixel >> 16) & 0xff;
      a = (pixel >> 24) & 0xff;
      //put the pixels back in (no change)
      data32[i] = (a << 24)
                | (b << 16)
                | (g << 8)
                | r;
    }
    </pre>

    <p>
    The fancy operators here like |, &, and 0xff are just bitwise OR, AND, mask.
    </p>

    <h3>
     References
   </h3>

   <ul>
    <li>
      <a href="http://falcon80.com/HTMLCanvas/PixelManipulation/getImageData.html" target="_blank">
        Getting Pixel Data Basics
      </a>
    </li>
    <li>
      <a href="https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/" target="_blank">
        Canvas Pixel Manipulation (2 techniques)
      </a>
    </li>
    <li>
      <a href="https://developer.mozilla.org/en/docs/Web/API/CanvasRenderingContext2D" target="_blank">
        Canvas Context 2d Reference
      </a>
    </li>
  </ul>

</section>

<footer>
  <span class="ribbon-outer">
    <span class="ribbon-inner">
      <p>This project by <a href="https://github.com/mattlockyer">mattlockyer</a> can be found on <a href="https://github.com/mattlockyer/iat455">GitHub</a></p>
    </span>
    <span class="left-tail"></span>
    <span class="right-tail"></span>
  </span>
  <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
  <span class="octocat"></span>
</footer>

</div>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-48997102-5");
    pageTracker._trackPageview();
  } catch(err) {}
</script>

</body>
</html>
